<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì• ‡∏ñ‡∏±‡∏á‡∏û‡∏±‡∏Å‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ - MyFamily Money</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap'); body { font-family: 'Kanit', sans-serif; background-color: #f8fafc; }</style>
</head>
<body class="min-h-screen p-4 pb-12 text-slate-800">
    <div class="max-w-md mx-auto space-y-5">
        <div class="flex items-center gap-3 mb-2"><button onclick="window.location.href='dashboard.html'" class="p-2 bg-white rounded-full shadow-sm text-slate-400 active:scale-90 transition">‚ùÆ</button><h1 class="text-xl font-black text-amber-600">üì• ‡∏ñ‡∏±‡∏á‡∏û‡∏±‡∏Å‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£</h1></div>

        <div class="bg-gradient-to-br from-amber-400 to-orange-500 p-8 rounded-[2.5rem] text-white shadow-xl text-center">
            <p class="text-xs font-bold uppercase tracking-[0.2em] opacity-80 mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏ñ‡∏±‡∏á‡∏û‡∏±‡∏Å</p>
            <h1 id="totalRes" class="text-5xl font-black">0 ‡∏ø</h1>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-50 space-y-4">
            <div class="grid grid-cols-2 gap-2 bg-slate-50 p-1.5 rounded-3xl">
                <button id="typeInc" onclick="setType('Income')" class="py-3 rounded-2xl font-bold text-sm transition-all bg-emerald-500 text-white shadow-md">‚úö ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</button>
                <button id="typeExp" onclick="setType('Expense')" class="py-3 rounded-2xl font-bold text-sm transition-all text-slate-400">‚ûñ ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</button>
            </div>
            <div>
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 tracking-widest">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                <input type="number" id="amount" placeholder="0.00" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none text-2xl font-black">
            </div>
            <div>
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 tracking-widest">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏Ø, ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏ä‡∏ß‡πå)</label>
                <input type="text" id="note" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none font-medium">
            </div>
            <button id="saveBtn" onclick="submitData()" class="w-full bg-slate-800 text-white py-4 rounded-[1.5rem] font-bold shadow-lg active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>

        <div class="space-y-3">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-4 mt-6">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÉ‡∏ô‡∏ñ‡∏±‡∏á‡∏û‡∏±‡∏Å</h3>
            <div id="logsContainer" class="space-y-2">
                </div>
        </div>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwkRheIvYk-SY0UQc9N4pP9hwYf5Vq3JQYq4PSOSW6HPnnKFzW-zZbqYFMExSsxnBHj/exec";
        let currentType = 'Income';

        function setType(t) {
            currentType = t;
            document.getElementById('typeInc').className = t === 'Income' ? "py-3 rounded-2xl font-bold text-sm transition-all bg-emerald-500 text-white shadow-md" : "py-3 rounded-2xl font-bold text-sm transition-all text-slate-400";
            document.getElementById('typeExp').className = t === 'Expense' ? "py-3 rounded-2xl font-bold text-sm transition-all bg-rose-500 text-white shadow-md" : "py-3 rounded-2xl font-bold text-sm transition-all text-slate-400";
        }

        async function loadData() {
            const res = await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'get_reservoir_logs' }) });
            const data = await res.json();
            if(data.status === 'success') {
                document.getElementById('totalRes').innerText = data.total.toLocaleString() + " ‡∏ø";
                document.getElementById('logsContainer').innerHTML = data.logs.map(log => `
                    <div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border-l-4 ${log.amount > 0 ? 'border-emerald-400' : 'border-rose-400'}">
                        <div><p class="text-[9px] font-bold text-slate-300 uppercase">${log.date}</p><p class="text-sm font-bold text-slate-700">${log.note}</p></div>
                        <p class="font-black ${log.amount > 0 ? 'text-emerald-600' : 'text-rose-500'}">${log.amount.toLocaleString()}</p>
                    </div>
                `).join('');
            }
        }

        async function submitData() {
            const amount = document.getElementById('amount').value;
            const note = document.getElementById('note').value;
            if(!amount || !note) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
            const btn = document.getElementById('saveBtn'); btn.disabled = true; btn.innerText = "‚è≥...";
            const user = JSON.parse(localStorage.getItem('userData'));
            try {
                await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'add_transaction', data: { userId: user.userId, amount: currentType === 'Expense' ? -Math.abs(amount) : Math.abs(amount), note: note, accType: 'Reservoir' } }) });
                document.getElementById('amount').value = ''; document.getElementById('note').value = '';
                loadData();
            } catch (e) { alert("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß"); }
            btn.disabled = false; btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
        }
        window.onload = loadData;
    </script>
</body>
</html>
