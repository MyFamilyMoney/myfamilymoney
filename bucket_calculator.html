<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ ‡∏à‡∏±‡∏î‡∏á‡∏ö 3 ‡∏ß‡∏á‡∏Å‡∏•‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-4 pb-10">
    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-xl text-center border-t-8 border-blue-600">
            <h1 class="text-xl font-black">üåÄ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h1>
            <input type="number" id="incomeInput" oninput="runPlanning()" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° ‡∏ø" class="w-full mt-6 p-5 border-2 border-blue-50 rounded-3xl text-2xl font-black text-center outline-none bg-slate-50 shadow-inner">
        </div>
        <div class="bg-white p-6 rounded-[2rem] shadow-md space-y-2">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">‚≠ï ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà</h3>
            <div id="fixedDetails" class="space-y-1 text-sm text-slate-600"></div>
            <div class="text-center bg-red-50 p-2 rounded-xl mt-2"><p class="text-xs font-black text-red-500">‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏±‡∏Å: <span id="totalFixed">0 ‡∏ø</span></p></div>
        </div>
        <div id="c3Section" class="bg-white p-6 rounded-[2.5rem] shadow-xl hidden">
            <div class="text-center mb-6 text-blue-600"><p class="text-xs font-bold uppercase tracking-widest">‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏°</p><h2 id="balanceC3" class="text-4xl font-black">0.00</h2></div>
            <div id="savingsDetails" class="space-y-3"></div>
            <canvas id="planningChart" class="mt-6"></canvas>
        </div>
        <button onclick="window.location.href='dashboard.html'" class="w-full py-4 text-slate-400 text-sm font-bold">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzZZpDPyHZjKTm4IdVsHSat6wuzSaxsV-6EZGnF-YCDar632A9DV0ZULzXcNrLwGLB3/exec";
        let config = {}; let chart;
        async function init() {
            const res = await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'get_bucket_config' }) });
            const data = await res.json();
            if (data.status === 'success') {
                config = data.config;
                let html = ""; let total = 0;
                config.circle1.concat(config.circle2).forEach(item => { html += `<div class="flex justify-between"><span>${item.name}</span><span class="font-bold">${item.value.toLocaleString()}</span></div>`; total += item.value; });
                document.getElementById('fixedDetails').innerHTML = html; document.getElementById('totalFixed').innerText = total.toLocaleString() + " ‡∏ø";
            }
        }
        function runPlanning() {
            const income = parseFloat(document.getElementById('incomeInput').value) || 0;
            const fixedTotal = config.circle1.concat(config.circle2).reduce((acc, cur) => acc + cur.value, 0);
            const balance = Math.max(0, income - fixedTotal);
            if (balance > 0) {
                document.getElementById('c3Section').classList.remove('hidden'); document.getElementById('balanceC3').innerText = balance.toLocaleString() + " ‡∏ø";
                const inv = balance * config.circle3.C3_INVEST_PCT, hea = balance * config.circle3.C3_HEALTH_PCT, tra = balance * config.circle3.C3_TRAVEL_PCT;
                document.getElementById('savingsDetails').innerHTML = `<div class="p-4 bg-yellow-50 rounded-2xl flex justify-between"><span>üèÜ ‡∏•‡∏á‡∏ó‡∏∏‡∏ô (40%)</span><span class="font-black">${inv.toLocaleString()}</span></div><div class="p-4 bg-green-50 rounded-2xl flex justify-between"><span>üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (30%)</span><span class="font-black">${hea.toLocaleString()}</span></div><div class="p-4 bg-purple-50 rounded-2xl flex justify-between"><span>‚úàÔ∏è ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (30%)</span><span class="font-black">${tra.toLocaleString()}</span></div>`;
                updateChart([inv, hea, tra]);
            } else { document.getElementById('c3Section').classList.add('hidden'); }
        }
        function updateChart(d) { const ctx = document.getElementById('planningChart').getContext('2d'); if (chart) chart.destroy(); chart = new Chart(ctx, { type: 'doughnut', data: { labels: ['‡∏•‡∏á‡∏ó‡∏∏‡∏ô', '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', '‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'], datasets: [{ data: d, backgroundColor: ['#EAB308', '#22C55E', '#A855F7'], borderWidth: 0 }] }, options: { cutout: '75%', plugins: { legend: { position: 'bottom' } } } }); }
        window.onload = init;
    </script>
</body>
</html>
