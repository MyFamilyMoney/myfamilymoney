<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5eEz3GQyRkVGVnA-W7OolZnrl6KgYM6UKs29hbDcWRKFCPxrAWh9aoPGcjJeZmKNP/exec"; 

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const msg = document.getElementById('message');
        const loader = document.getElementById('loader');
        
        btn.classList.add('hidden');
        loader.classList.remove('hidden');
        msg.innerText = "";

        const payload = {
            action: "login",
            data: {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            }
        };

        try {
            // à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸›à¸¢à¸±à¸‡ GAS (à¸¥à¸š no-cors à¸­à¸­à¸à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸£à¸±à¸šà¸„à¹ˆà¸²à¸à¸¥à¸±à¸šà¸¡à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹„à¸”à¹‰)
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            });

            const result = await response.json(); // à¸­à¹ˆà¸²à¸™à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸ˆà¸²à¸ GAS

            if (result.status === 'success') {
                msg.className = "mt-4 text-center text-sm font-medium text-green-600";
                msg.innerText = "à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ! à¸à¸³à¸¥à¸±à¸‡à¹„à¸›à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸...";
                
                // ðŸš¨ à¹€à¸à¹‡à¸šà¸à¸¸à¸à¹à¸ˆà¸ªà¸³à¸„à¸±à¸à¹„à¸§à¹‰à¹ƒà¸Šà¹‰à¹ƒà¸™à¸«à¸™à¹‰à¸² Dashboard
                localStorage.setItem('userId', result.user.userId);
                localStorage.setItem('familyId', result.user.familyId);
                localStorage.setItem('userName', result.user.name);

                setTimeout(() => {
                    window.location.href = "dashboard.html";
                }, 1500);
            } else {
                throw new Error(result.message);
            }

        } catch (error) {
            msg.className = "mt-4 text-center text-sm font-medium text-red-600";
            msg.innerText = "à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”: " + error.message;
            btn.classList.remove('hidden');
            loader.classList.add('hidden');
        }
    });
</script>
